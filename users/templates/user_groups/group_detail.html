{% extends 'core/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
  Groups - Nepal Audit Management System
{% endblock title %}

{% block page_title %}
{{group.name}}
{% endblock page_title %}

{% block page_actions %}
  <a class="btn btn-success btn-with-icon" data-remote="{% url 'users:create_group' %}"
    href="{% url 'users:create_group' %}" data-toggle="modal" data-target="#modalUserGroupCreate">
    <i class="ic-add"></i>
    User Group थप्नुहोस्
  </a>
{% endblock page_actions %}


{% block content %}
<div class="inner">
  <div class="container-fluid px-3">
    <div class="row">
      <div class="col">
        <div class="d-flex justify-content-between mb-4">
        </div>
        <div class="d-flex justify-content-between mb-4">
          <h5 class="heading">समूह विवरण</h5>

          <div class="d-flex align-items-right"> 
            <a class="btn btn-info align-vertical" href="{% url 'users:groups_list' %}">
              <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="mr-2"
                height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                  d="M5.854 4.646a.5.5 0 010 .708L3.207 8l2.647 2.646a.5.5 0 01-.708.708l-3-3a.5.5 0 010-.708l3-3a.5.5 0 01.708 0z"
                  clip-rule="evenodd"></path>
                <path fill-rule="evenodd" d="M2.5 8a.5.5 0 01.5-.5h10.5a.5.5 0 010 1H3a.5.5 0 01-.5-.5z"
                  clip-rule="evenodd"></path>
              </svg>
              <span>पछाडी जानुहोस् </span>
            </a>
          </div>
        </div>
      </div>
    </div>

      <div class="card_structured">
        <div class="row no-gutters">
          <div class="col-lg-4 border-right border-light">
            <div class="d-flex justify-content-between align-items-right p-3 border-light border-bottom">
                <h6>प्रयोगकर्ता सूची</h6>
                <button class="btn btn-info" data-toggle="modal" data-target="#searchUser">प्रयोगकर्ता थप्नुहोस्
                </button>
            </div>

            <div class="scrollable" style="height: 400px;">
              <ul class="list list-links">
                {% for user in group.user_set.all %}
                <li>
                  <a>{{ user.username }}</a> <i class="ic-delete" data-toggle="modal"
                    data-target="#removeUser{{user.pk}}"></i>
                </li>
                {% endfor %}

              </ul>
            </div>
          </div>
          <div class="col-lg-8 border-right border-light">
            <div class="d-flex justify-content-between align-items-center p-3 border-light border-bottom">
              <h6>
                अनुमति सूची
              </h6>
                <button class="btn btn-primary" data-toggle="modal" data-target="#searchPermission">अनुमति
                    थप्नुहोस्</button>
            </div>
            <div class="scrollable" style="height: 400px;">
              <ul class="list list-links">
                {% for permission in group.permissions.all %}
                <li>
                  <a class="nav-link" href="#">{{ permission.name }}</a>
                  <i class="ic-delete" data-toggle="modal" data-target="#removePermission{{permission.pk}}"></i>
                </li>
                {% endfor %}

              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</main>
</div>

<div class="modal fade" id="searchUser" tabindex="-1" role="dialog" aria-labelledby="modalOpen" aria-hidden="true">
  <div class="modal-dialog modal_dma" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="text-white">प्रयोगकर्ता</h6>
        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em"
          xmlns="http://www.w3.org/2000/svg" data-dismiss="modal" aria-label="Close">
          <path
            d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z">
          </path>
        </svg>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'users:assign_users_in_group' group.pk %}">
          {% csrf_token %}
          <div class="form-row">
            <div class="col-sm-12">
              <select class="form-control js-example-tokenizer" name="users" multiple="multiple">
                {% for user in users %}
                <option value="{{user.pk}}">{{user.username}}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-info">थप्नुहोस्</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="searchPermission" tabindex="-1" role="dialog" aria-labelledby="modalOpen"
  aria-hidden="true">
  <div class="modal-dialog modal_dma" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="text-white"> अनुमति</h6>
        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em"
          xmlns="http://www.w3.org/2000/svg" data-dismiss="modal" aria-label="Close">
          <path
            d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z">
          </path>
        </svg>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'users:assign_perm_in_group' group.pk %}">
          {% csrf_token %}
          <div class="form-row">
            <div class="col-sm-12">
              <select class="form-control js-example-category" name="permissions" multiple="multiple">
                {% for permission in permissions %}
                <option value="{{permission.pk}}">{{permission.name}}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-info" id="id-btn">थप्नुहोस्</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>

{% for user in group.user_set.all %}
<div class="modal fade" id="removeUser{{user.pk}}" tabindex="-1" role="dialog" aria-labelledby="modalOpen"
  aria-hidden="true">
  <div class="modal-dialog modal_dma" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="text-white">प्रयोगकर्ता</h6>
        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em"
          xmlns="http://www.w3.org/2000/svg" data-dismiss="modal" aria-label="Close">
          <path
            d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z">
          </path>
        </svg>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'users:remove_user_from_group' group.pk user.pk %}">
          {% csrf_token %}
          <div class="form-row">
            <div class="col-sm-12">
              <h6>Are you sure you want to remove from this group ?</h6>
            </div>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-info">Remove</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>
{% endfor %}
{% for permission in group.permissions.all %}
<div class="modal fade" id="removePermission{{permission.pk}}" tabindex="-1" role="dialog" aria-labelledby="modalOpen"
  aria-hidden="true">
  <div class="modal-dialog modal_dma" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="text-white">अनुमति</h6>
        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="1em" width="1em"
          xmlns="http://www.w3.org/2000/svg" data-dismiss="modal" aria-label="Close">
          <path
            d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z">
          </path>
        </svg>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'users:remove_perm_from_group' group.pk permission.pk %}">
          {% csrf_token %}
          <div class="form-row">
            <div class="col-sm-12">
              <h6>Are you sure you want to remove from this group ?</h6>
            </div>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-info">Remove</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>
{% endfor %}

{% endblock %}
{% block extrascripts %}
<script>

  $(".js-example-tokenizer").select2({
    tags: true,
    width: '390',
    tokenSeparators: [',']
  })

  $(".js-example-category").select2({
    tags: true,
    width: '390',
    tokenSeparators: [',']
  })
</script>

{% endblock %}
