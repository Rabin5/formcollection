{% extends 'core/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
  कोभिड-१९ विशेष लेखापरीक्षणको सिलसिलामा - Nepal Audit Management System
{% endblock title %}

{% block page_title %}
कोभिड-१९ विशेष लेखापरीक्षणको सिलसिलामा प्रदेश मन्त्रालयले माग गरेको सूचना एवं जानकारी उपलव्ध गराउने प्रयोजनको लागि तयार गरेको प्रश्नावली एवं विवरण 
{% endblock page_title %}

{% block page_actions %}
  <a class="btn btn-success btn-with-icon" id='create_collection'>
    <i class="ic-add"></i>
    प्रश्नावलीहरू भर्नुहोस्
  </a>
{% endblock page_actions %}

{% block content %}
<table class="table table-striped table-borderless">
  <thead>
    <tr>
      <th>#.</th>
      <th>State</th>
      <th>Status</th>
      <th>कार्य</th>
    </tr>
  </thead>
  <tbody>
    {% for form_collection in form_collections %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ form_collection }}</td>
        <td>{{ form_collection.get_status_display }}</td>
        {% if form_collection.get_status_display == 'SUBMITTED' %}
          <td>
            <a href="{% url 'local_level_forms:review' form_collection.pk 'submitted' %}">
              Review
            </a>
          </td>
        {% elif form_collection.get_status_display not in 'APPROVED, REJECTED' %}
          <td class="action">
            <a href="{% url 'local_level_forms:local_level_update' form_collection.pk %}">
              <i class="ic-edit mr-2"></i>
            </a>
            <a data-remote="{% url 'local_level_forms:local_level_delete' form_collection.pk %}"
              href="{% url 'local_level_forms:local_level_delete' form_collection.pk %}" data-toggle="modal" data-target="#modalProdDelete">
              <i class="ic-delete"></i>
            </a>
          </td>
        {% endif %}
      </tr>
    {% endfor %}
  </tbody>
</table>

{% block pagination %}
  {% include 'master_data/partials/pagination.html' %}
{% endblock pagination %}

{% endblock content %}

{% block modal %}

<div class="modal fade" id="modalProdDelete" tabindex="-1" role="dialog" aria-labelledby="modalProdDelete" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
    </div>
  </div>
</div>

{% endblock %}

{% block extrascripts %}
<script>
    $(document).ready(function(){
      $('#create_collection').on('click', function(){
        fetch("{% url 'local_level_forms:local_level_create' %}", {
          method: 'POST',
          dataType: "json",
          headers: { "X-CSRFToken": '{{csrf_token}}' },
        })
        .then(response => response.json())
        .then(data => {
          window.location.href = data.url
        })
        .catch(function(err){
            console.log(err);
        });
    })

    $('#modalProdDelete').on('shown.bs.modal', function (e) {
      var button = $(e.relatedTarget);
      var modal = $(this);
      modal.find('.modal-content').load(button.data("remote"));
    });
})

</script>
{% endblock extrascripts %}