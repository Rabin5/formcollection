{% extends 'core/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
  Form Collection - Nepal Audit Management System
{% endblock title %}

{% block page_title %}
Form Collections
{% endblock page_title %}

{% block page_actions %}
  <a class="btn btn-success btn-with-icon" id='create_collection'>
    <i class="ic-add"></i>
    Collection थप्नुहोस्
  </a>
{% endblock page_actions %}

{% block content %}
<table class="table table-striped table-borderless">
  <thead>
    <tr>
      <th>#.</th>
      <th>State</th>
      <th>Status</th>
      <th class="text-right">कार्य</th>
    </tr>
  </thead>
  <tbody>
    {% for form_collection in form_collections %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ form_collection.get_state_display }}</td>
        <td>{{ form_collection.get_status_display }}</td>
        <td class="action">
          <a href="{% url 'forms:update' form_collection.pk %}">
            <i class="ic-edit mr-2"></i>
          </a>
          <a data-remote="{% url 'forms:delete' form_collection.pk %}"
            href="{% url 'forms:delete' form_collection.pk %}" data-toggle="modal" data-target="#modalProdDelete">
            <i class="ic-delete"></i>
          </a>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock content %}

{% block extrascripts %}
{% comment %} <script src="{% static 'js/post_data.js' %}"></script> {% endcomment %}
<script>
    $(document).ready(function(){
    $('#create_collection').on('click', function(){
        fetch("{% url 'forms:create' %}", {
            method: 'POST',
            dataType: "json",
            headers: { "X-CSRFToken": '{{csrf_token}}' },
        })
        .then(function(response){
            console.log(JSON.parse(response))
            console.log(response['body'])
            // window.location.replace(response['url']);
        })
        .catch(function(err){
            console.log(err);
        });
        /*
        $.ajax({
            headers: { "X-CSRFToken": '{{csrf_token}}' },
            url: "{% url 'forms:create' %}",
            method: 'POST',
            success: function(data) {
                //console.log(data)
                window.location.replace(data['url']);
            }
        })
        */
    })
})
</script>
{% endblock extrascripts %}